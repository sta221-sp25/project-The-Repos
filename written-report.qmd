---
title: "Written Report on Factors that Help Diagnose Autism"
author: "The Repos - Jeffrey Bohrer, Alexandra Green, Anna Zhang, Kevin Lee"
date: "March 20, 2025"
format: pdf
execute: 
  warning: false
  message: false
  echo: false
editor: visual
---

```{r}
#|echo: false
#|warning: false
#|message: false
#| label: load packages and data

library(tidyverse)
library(tidymodels)
library(patchwork)
library(knitr)
library(tibble)
library(kableExtra)
library(glmnet)
library(pROC)
library(car)
library(corrplot)
library(ggcorrplot)
library(Stat2Data)  #empirical logit plots

autism_ds <- read_csv("data/autism_ds.csv") %>%
  mutate(ethnicity = ifelse(ethnicity == "others", "Others", ethnicity))
```

## Introduction

Autism Spectrum Disorder (ASD) remains a highly prevalent condition despite modern strides made in medical technology. It is reported that nearly 2.2% of adults are affected by ASD, and growing awareness has led to an uptick in diagnoses, particularly in adults who went undiagnosed early in life (Hirota 2023). However, ASD screening tests for all age groups currently contain significant inaccuracies. For example, the most widely used toddler screening test, CHAT-R/FAs, was recently found to produce false negatives in 25% of cases. In contrast, the most commonly used adult autism screening test – the Autism-Spectrum Quotient (AQ) – was found to have limited predictive value in certain populations (Aishworiya 2023; Curnow 2023). Therefore, it has become critical to identify stronger predictors or explore underlying relationships to have more accurate tests and models to predict ASD in adults.

In this study, we will focus on identifying the features that most greatly affect the probability of being encouraged to pursue a diagnosis within this particular questionaire, as created by Prof. Fadi Thabtau of the Manukau Institute of Technology. The data was sourced from users of his app, ASDTests, which screens its users for potential indicators of autism using a ten-question survey. The data set being used will contain ten characteristics along with the answers of each individual to this survey. Because ASD is difficult to identify and can significantly impair an individual's quality of life, understanding the relationship between demographics, certain behaviors, and their association with autism could encourage individuals to seek diagnosis and gain the self-understanding they need. These adults who receive a positive diagnosis can then access the necessary resources for support. Our goal is to identify which aspects of this questionnaire are most closely associated with being encouraged to pursue an autism diagnosis.

**Univariate EDA**

```{r}
summary(autism_ds$result)
prop_high_scores <- nrow(autism_ds[autism_ds$'Class/ASD' == 'YES', ])/nrow(autism_ds)
prop_high_scores
```

```{r fig.width=5, fig.height=3.5}
#|echo: false
#|warning: false
#|message: false
autism_ds |>
  ggplot(aes(x = result)) +
  geom_bar(fill = "skyblue") +
  scale_x_continuous(breaks = seq(0, 10, 1), 
                     labels = as.character(seq(0, 10, 1))) +
  labs(x = "Score",
       y = "Count",
       title = "Histogram of Scores") + 
  theme_minimal()
```

As we can see in a quick summary of our data, the variable we are most interested in – the final score of users – ranges from 0 to 10, which makes sense as 10 questions can be answered either 'Yes' or 'No'. Generally, the scores are a bit right-skewed, with a single peak around 4 or 5 points. The mean score is 5.077, and the median is 5, both of which are relatively high considering that scores above 6 warrant further diagnostic evaluation. However, because suspecting a diagnosis is a reason for taking the test to begin with, these statistics are reasonable reflections of the test-taking population. We also observe that roughly 30% of test takers are encouraged to seek a diagnosis due to a score higher than 6, as calculated above. We also observe the IQR to be 4 points, as most test takers have a score between 3 and 7 points inclusive. In the context of the data, such a spread is reasonable, and no outliers exist which is understandable given the limited range of scores.

```{r fig.width=5, fig.height=3.3}
#|echo: false
#|warning: false
#|message: false
autism_ds |>
  ggplot(aes(x = fct_infreq(ethnicity))) +
  geom_bar(fill = "skyblue") +
  labs(x = "Ethnicity",
       y = "Count",
       title = "Distribution of Ethnicity") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

We observe here that the most common ethnicity was White-Europeans, with over 200 observations in our dataset. Secondly and thirdly, we observe the Asian and Middle Eastern populations to be above 100 and slightly below 100 observations, respectively. All other ethnicities have fewer than 50 observations in our data set, suggesting it may be more difficult to conclude about these populations. We can now check whether the proportion of individuals encouraged to seek a diagnosis varies by ethnicity:

```{r fig.width=5, fig.height=3.3}
#|echo: false
#|warning: false
#|message: false
autism_ds %>%
  group_by(ethnicity) %>%
  summarize(yes_count = sum(`Class/ASD` == "YES"),
            total_count = n(),
            proportion_yes = yes_count / total_count) %>%
  ggplot(aes(x = fct_reorder(ethnicity, proportion_yes, .desc=TRUE), y = proportion_yes)) +
  geom_col(fill = "skyblue") +
  labs(x = "Ethnicity",
       y = "Proportion of High Test Scores",
       title = "Proportion of Indicative Test Scores by Ethnicity") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

As we can see here, the population with the highest proportion of test takers receiving a high test score was the Latino population, with close to half achieving a score higher than a 6. Since this is a comparably uncommon population in our data set, it does raise questions of whether it is indicative of the greater Latino population or merely due to the smaller sample size in our data set. Additionally, the White-European, Black, and Hispanic populations also demonstrate a greater proportion of high test scores. The variation in these proportions according to ethnicity also warrants further exploration into how the distribution of test scores differs by ethnicity. Specifically, the questions remain of whether this means the rates of under- or over-diagnosis vary for different ethnic groups, and if so, what alterations would be necessary to ameliorate these errors.

```{r}
summary(autism_ds$age)
```

```{r, fig.width=5, fig.height=3.5}
#|echo: false
#|warning: false
#|message: false
autism_ds |>
  ggplot(aes(x = age)) +
  geom_bar(fill = "skyblue") +
  labs(x = "Age",
       y = "Count",
       title = "Distribution of Age") +
  xlim(10, 75) + 
  theme_minimal()
```

Generally, we observe the distribution of ages to possess a strong right-skewness, with a mean age of 30.22 and a median age of 27. There is a clear peak in the age distribution roughly around the early to mid-20s. The ages range from a minimum of 17 to a maximum of 383 – a false observation that should be filtered from the data. The IQR is 13 years, which is a fairly small spread given the range of ages, as we observe that the majority of test-takers are under 30 years old.

```{r, fig.height=6, fig.width=7}
#|echo: false
#|warning: false
#|message: false
autism_ds |>
  mutate(
    small_sounds = if_else(small_sounds == 1, "Yes", "No"),
    difficult_to_understand_char = if_else(difficult_to_understand_char == 1, "Yes", "No"),
    ease_to_read_between_lines = if_else(ease_to_read_between_lines == 1, "Yes", "No"),
    focus_on_whole_picture = if_else(focus_on_whole_picture == 1, "Yes", "No"),
    i_can_tell_if_someone_bored = if_else(i_can_tell_if_someone_bored == 1, "Yes", "No"),
    i_can_multi_task = if_else(i_can_multi_task == 1, "Yes", "No"),
    i_can_tell_feelings_from_faces = if_else(i_can_tell_feelings_from_faces == 1, "Yes", "No"),
    i_can_go_back_to_work_when_interrupted = if_else(i_can_go_back_to_work_when_interrupted == 1, "Yes", "No"),
    i_like_to_collect_info_on_categories = if_else(i_like_to_collect_info_on_categories == 1, "Yes", "No"),
    i_find_it_hard_to_figure_out_others_intentions = if_else(i_find_it_hard_to_figure_out_others_intentions == 1, "Yes", "No")
  ) |>
  rename(
    `Small Sounds` = small_sounds,
    `Hard to Understand Characters` = difficult_to_understand_char,
    `Reads Between the Lines Easily` = ease_to_read_between_lines,
    `Focuses on Whole Picture` = focus_on_whole_picture,
    `Can Tell If Someone's Bored` = i_can_tell_if_someone_bored,
    `Can Multitask` = i_can_multi_task,
    `Can Read Feelings From Faces` = i_can_tell_feelings_from_faces,
    `Resumes Work After Interruption` = i_can_go_back_to_work_when_interrupted,
    `Likes to Collect Category Info` = i_like_to_collect_info_on_categories,
    `Finds It Hard to Read Intentions` = i_find_it_hard_to_figure_out_others_intentions
  ) |>
  select("Small Sounds":"Finds It Hard to Read Intentions") |>
  pivot_longer(everything(), names_to = "question", values_to = "response") |>
  ggplot(aes(x = question, fill = response)) +
  geom_bar(position = "fill") +
  labs(
    x = "Question",
    y = "Proportion",
    title = "Distribution of Yes/No Responses to Autism Screening Questions",
    fill = "Response"
  ) +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The two questions with the highest proportion of "Yes" responses were "resume work after interruption" and "small sounds," suggesting that these behaviors are common among respondents. On the other hand, the questions "can multitask" and "likes to collect category info" had noticeably lower "Yes" responses, potentially indicating difficulties in such areas. Most questions, however, had roughly even proportions between "Yes" and "No" responses.

**Bivariate EDA**

```{r}
#|echo: false
#|warning: false
#|message: false
### Result score distributions by ethnicity
ggplot(autism_ds, 
       aes(x = result,
           y = ethnicity,
           fill = ethnicity)) +
  geom_boxplot() +
  labs(
    title = "Scores Distributions Across Ethnicity",
    x = "Score",
    y = "Ethnicity",
    fill = "Ethnicity"
  ) +
  theme_minimal()

ggplot(autism_ds, 
       aes(x = result,
           y = relation,
           fill = relation)) +
  geom_violin(alpha = 0.5) +
  labs(
    title = "Score Distribution by Respondent Type",
    x = "Score",
    y = "Relation",
    fill
  ) +
  theme_minimal()

```

Here we present several graphs displaying bivariate relationships. With our first set of box plots, we find further evidence for our previous suspicion that test score distributions differ by ethnicity. Although most ethnicities have a median within the range of roughly 3 to 6, some ethnicities, like the White-European, Black, and Hispanic populations, demonstrate a greater spread through their larger IQRs, while the Turkish, Middle Eastern, and Asian populations are much more concentrated around their medians. However, most ethnicities appear to have values almost entirely across the range of 0 to 10 in their test scores.

Interestingly, we can also observe how the relationship between the test taker and the subject of the questions may lead to different distributions of test scores. In the case when it is filled out by a relative or health care professional for example, the observed test score is 2 or greater, while in the case of the test taker being the subject or the parent of the subject, some still received a score of 0. This could reflect how personal biases or relationships affect truthfulness during the test.

This initial exploration leads us to investigate one of these questions further, and particularly how our demographic data may impact the probability of being encouraged to seek a formal diagnosis. Though we cannot identify a definitive answer of whether it is due to social or cultural perceptions of autism within these subgroups or true difference in rates of its presence, it is worth identifying whether over- or under-diagnosis for certain subgroups is possible.

## Methodology

**Choosing Predictors**

```{r}
#TODO: check for redundancy of mutating the highProb column and the usage of the reduced model for some of our features

### Ethnicity DD
autism_ds <- autism_ds %>%
  mutate(highProb = if_else(result > 6, 1, 0))

reduced_model <- glm(highProb ~ 1, 
              data = autism_ds, family = "binomial")
ethnicity_model <- glm(highProb ~ ethnicity, 
              data = autism_ds, family = "binomial")

cat("D-reduced:", (deviance_reduced <- -2 * glance(reduced_model)$logLik), "\n")
cat("D-full:", (deviance_full <- -2 * glance(ethnicity_model)$logLik), "\n")
cat("G-stat:", (G <- deviance_reduced - deviance_full), "\n")
cat("p-value:", pchisq(G, df = 9, lower.tail = FALSE), "\n")

tidy(ethnicity_model) |>
  kable(digits = 3)
```

```{r}
### Relation DD

relation_model <- glm(highProb ~ relation, 
              data = autism_ds, family = "binomial")

cat("D-reduced:",(deviance_reduced <- -2 * glance(reduced_model)$logLik), "\n")
cat("D-fulll:",(deviance_full <- -2 * glance(relation_model)$logLik), "\n")
cat("G-stat:",(G <- deviance_reduced - deviance_full), "\n")
cat("p-value:",pchisq(G, df = 4, lower.tail = FALSE), "\n")

tidy(relation_model) |>
  kable(digits = 3)
```

```{r}
## Age
reduced_model <- glm(highProb ~ 1, 
              data = autism_ds, family = "binomial")
age_model <- glm(highProb ~ age, 
              data = autism_ds, family = "binomial")

cat("D-reduced:", (deviance_reduced <- -2 * glance(reduced_model)$logLik), "\n")
cat("D-full:", (deviance_full <- -2 * glance(age_model)$logLik), "\n")
cat("G-stat:", (G <- deviance_reduced - deviance_full), "\n")
cat("p-value:", pchisq(G, df = 1, lower.tail = FALSE), "\n")

tidy(age_model) |>
  kable(digits = 3)
```

```{r}
### Gender
gender_model <- glm(highProb ~ gender, 
              data = autism_ds, family = "binomial")

cat("D-reduced:", (deviance_reduced <- -2 * glance(reduced_model)$logLik), "\n")
cat("D-full:", (deviance_full <- -2 * glance(gender_model)$logLik), "\n")
cat("G-stat:", (G <- deviance_reduced - deviance_full), "\n")
cat("p-value:", pchisq(G, df = 1, lower.tail = FALSE), "\n")

tidy(gender_model) |>
  kable(digits = 3)
```

```{r}
### Jaundice
jaundice_model <- glm(highProb ~ jundice, 
              data = autism_ds, family = "binomial")

cat("D-reduced:", (deviance_reduced <- -2 * glance(reduced_model)$logLik), "\n")
cat("D-full:", (deviance_full <- -2 * glance(jaundice_model)$logLik), "\n")
cat("G-stat:", (G <- deviance_reduced - deviance_full), "\n")
cat("p-value:", pchisq(G, df = 1, lower.tail = FALSE), "\n")

tidy(jaundice_model) |>
  kable(digits = 3)
```

A drop-in-deviance test between a logistic null model without predictor variables and a logistic model with a single predictor was systematically conducted across ethnicity, gender, presence of neonatal jaundice, and relationship as a means of assessing which predictors provide a statistically significant improvement in model fit against the null condition. The hypothesis for this test can be observed below, where $\beta_1$ represents the coefficient for the associated predictor variable: $$H_0: \beta_1 = 0$$ $$H_a: \beta_1 \neq 0$$

Table 1: Drop-in-deviance test results comparing null model $log(\frac{\hat\pi}{1-\hat\pi})=\beta_0$ to single-predictor model $log(\frac{\pi}{1-\pi})=\beta_0 + \beta_1X_1$

From the results of this test, it is evident that the parameters that are statistically significant for model fit are ethnicity, gender, and, quite surprisingly, neonatal jaundice when compared to a null model as the p-values are either significantly less than 0.05 (as in ethnicity) or slightly below it (gender and jaundice). We further investigate the correlation between answers to questions below:

```{r}
q1_to_10 <- autism_ds |>
  select(small_sounds, difficult_to_understand_char,
         ease_to_read_between_lines,
         focus_on_whole_picture,
         i_can_tell_if_someone_bored,
         i_can_multi_task,
         i_can_tell_feelings_from_faces,
         i_can_go_back_to_work_when_interrupted,
         i_like_to_collect_info_on_categories,
         i_find_it_hard_to_figure_out_others_intentions)

cor_matrix <- cor(q1_to_10, method = "pearson", use = "complete.obs")

short_names <- c(
  "Q1", "Q2", "Q3", "Q4", "Q5",
  "Q6", "Q7", "Q8", "Q9", "Q10"
)

colnames(cor_matrix) <- short_names
rownames(cor_matrix) <- short_names

corrplot(cor_matrix,
         method = "color",
         type = "upper",
         tl.col = "black",
         tl.cex = 1,
         addCoef.col = "black",
         number.cex = 0.7,
         diag = FALSE)
```

By computing a correlation heat map among the ten behavior questions to check multicollinearity, we note that surprisingly, only a few questions have stronger correlations with one another. This is rather unexpected since we would expect many behaviors to be grouped together and more correlated (e.g., social behaviors). However, the highest correlation is between questions 6 and 9, which are the questions about multitasking and liking to collect information, respectively – this is also a rather surprising pairing.

However, we note that having more uncorrelated questions is actually preferable, as that indicates that we are asking about a variety of behaviors that may lead to a diagnosis of autism, improving the chances we identify whether a subject has multiple indicators. Thus, we continue with quantifying the relationship between demographic data and high test scores.

**Fitting the Model**

An additive logistic regression model of the following form will be fitted:

$$log(\frac{\hat\pi}{1-\hat\pi})=\beta_0$$

Given that the condition we established for "high probability" (i.e. total score greater than 6) allows the logistic model to perfectly separate the response variable in the data into "high" and "low" probabilities as a binary classification, a penalized logistic regression model (LASSO) was employed to reduce the risk of overfitting (Marin, 2021).

```{r}
model_one_fit <- glm(highProb ~ 1,
                       data = autism_ds, 
                       family = binomial)
model_one_fit |>
  tidy() |>
  kable(digits = 3)
```

Then to consider adding the demographic data as potential predictors of a high score, we first fit as the following:

$$log(\frac{\hat\pi}{1-\hat\pi})=\beta_0 + \beta_{ethnicity}X_{ethnicity}+\beta_{gender}X_{gender}+\beta_{jaundice}X_{jaundice}$$

```{r}
model_two_fit <- glm(highProb ~ 
                       ethnicity + gender + jundice,
                       data = autism_ds, 
                       family = binomial)

model_two_fit |>
  tidy() |>
  kable(digits = 3)

cat("D-reduced:", (deviance_reduced <- -2 * glance(model_one_fit)$logLik), "\n")
cat("D-full:", (deviance_full <- -2 * glance(model_two_fit)$logLik), "\n")
cat("G-stat:", (G <- deviance_reduced - deviance_full), "\n")
cat("p-value:", pchisq(G, df = 1, lower.tail = FALSE), "\n")

AIC(model_one_fit, model_two_fit)
BIC(model_one_fit, model_two_fit)
```

To compare the reduced and full models, both AIC and BIC of model two are both smaller than the values of model one. Additionally, we note that the test statistic generated by a drop-in-deviance test indicates statistical significance of adding these predictors to the model.

The intercept means that for a test taker who is an Asian woman, born without neonatal jaundice, we expect the odds of having a high score on the questionnaire to be 0.168 (calculated from exp(-1.783)).

The coefficients of ethnicity are compared to the baseline group, which is Asian. For instance, for the coefficient of `ethnicityBlack`, it means that the odds of someone identified as Black to have a high probability of autism are expected to be 4.67 (calculated from exp(1.542)) times the odds of someone identified as Asian, holding age, gender, and presence of neonatal jaundice constant.

We also note that the p-value of gender indicates a lack of statistical significance for determining a high score on the test – a surprising result given that typically, women are under-diagnosed, so we would expect there to be a lower rate of high scores. However, given that this is only a preliminary test, this could suggest that women are just as likely to seek further diagnoses as men are, but less likely to receive the necessary official diagnosis once under the care of a practitioner.

The odds of someone who was born with neonatal jaundice to have a high score on the questionnaire are expected to be 1.90 (calculated from exp(0.640)) times the odds of someone who was not born with jaundice, holding all else constant.

```{r, echo = FALSE}
complex_log_mod <- glm(highProb ~ 
                         ethnicity +
                         gender +
                         jundice,  # spelling is incorrect in data set
                       data = autism_ds, 
                       family = binomial)
X <- model.matrix(highProb ~ 
                    ethnicity +
                    gender +
                    jundice,
                  data = autism_ds)[, -1]  # Remove intercept column

# Define response variable
y <- autism_ds$highProb

# Fit lasso logistic regression with cross-validation
cv_fit <- cv.glmnet(X, y, family = "binomial", alpha = 1)

# Best lambda based on cross-validation
best_lambda <- cv_fit$lambda.min

# Final lasso model using the best lambda
final_lasso_model <- glmnet(X, y, family = "binomial", alpha = 1, lambda = best_lambda)

tidy(final_lasso_model) |>
  kable(digits = 3)
```

This model was then employed to augment the original data frame and obtain the estimated probabilities for each observation, these would later be employed for an ROC curve to determine the optimal prediction threshold.

## Results

```{r}
model_two_fit_aug <- augment(model_two_fit)

pred_prob <- predict.glm(model_two_fit, type = "response")

model_two_fit_aug <- model_two_fit_aug |>
  mutate(
    highProb = factor(highProb, levels = c(0, 1))  # 1 = "event", 0 = "non-event"
  )

model_two_fit_aug <- model_two_fit_aug |> 
  bind_cols(pred_prob = pred_prob)

roc_curve <- model_two_fit_aug |>
  roc_curve(highProb, pred_prob,
            event_level = "second")

autoplot(roc_curve) +
  ggplot2::ggtitle("ROC")

model_two_fit_aug |>
  roc_auc(highProb, pred_prob,
    event_level = "second"
  )
```

The area under the curve is 0.740, which for a model fitted to demographic data, indicates that further investigation into how these questions may over- or under-diagnose certain populations could still be worth pursuing. However, as that is still a fairly low AUC, it could also indicate that this particular questionnaire does a relatively good job of avoiding under- or over-diagnosis, and could include questions that are a strong reference for future screening.

For model assumptions, logistic regression requires the assumption of log-odds possessing linearity, randomness, and independence of observations. It is worth noting that of these conditions, randomness is unlikely to be satisfied due to the nature of the data set – it was collected by people who already were likely to suspect an ASD diagnosis, as they are those who took the test voluntarily. However, our other two assumptions are likely to hold for this model, and we still determine our questions, model, and results worth further investigation. We do not need to check linearity as none of our predictors are quantitative and our all categorical, we do not need to. We can also assume independence as there are no anticipated temporal or spatial relationships between individuals taking the questionnaire.

Once more, a .740 AUC for factors independent of autistic behaviors indicate that further research is required in the diagnostic criteria and formulation of questionnaires of for autism – but could also suggest that perhaps this particular test is less biased compared to others. It is worth ensuring that everyone can receive the appropriate diagnosis, and thus, receive any desired accommodations for improvement of quality of life.

## References

Aishworiya, R., Kim, V., MA, Stewart, S., Hagerman, R., & Feldman, H. M. (2023). Meta-analysis of the Modified Checklist for Autism in Toddlers, Revised/Follow-up for Screening. *PEDIATRICS*, *151*(6). https://doi.org/10.1542/peds.2022-059393

Curnow, E., Utley, I., Rutherford, M., Johnston, L., & Maciver, D. (2023). Diagnostic assessment of autism in adults – current considerations in neurodevelopmentally informed professional learning with reference to ADOS-2. *Frontiers in Psychiatry*, *14*. https://doi.org/10.3389/fpsyt.2023.1258204

Hirota, T., & King, B. H. (2023). Autism spectrum Disorder. *JAMA*, *329*(2), 157. https://doi.org/10.1001/jama.2022.23661

Marin, Z. (2021, April 26). GLM fit: Algorithm did not converge – How to fix it. Statology. https://www.statology.org/glm-fit-algorithm-did-not-converge/ ::: callout-important Before you submit, make sure your code chunks are turned off with `echo: false` and there are no warnings or messages with `warning: false` and `message: false` in the YAML. :::
